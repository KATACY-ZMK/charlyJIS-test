#include <dt-bindings/zmk/mouse.h>
#include <behaviors.dtsi>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/outputs.h>
#include <dt-bindings/zmk/pointing.h>

#include <input/processors.dtsi>
#include <dt-bindings/zmk/input_transform.h>

/* 名前を trackball_listener に修正し、末尾にセミコロンを追加 */
&trackball_listener {
    /* ① 通常時の速度 (1.5倍) */
    input-processors = <&zip_xy_scaler 3 2>;

    /* ② 低速モード (SNIPE: Layer 3) */
    /* 1/2 = 0.5倍速 */
    snipe {
        layers = <3>;
        input-processors = <&zip_xy_scaler 1 2>;
    };

    /* ③ 高速モード (MOUSE: Layer 2) */
    /* 5/2 = 2.5倍速 (ここは好きな数値に変えてOK) */
    turbo {
        layers = <2>;
        input-processors = <&zip_xy_scaler 5 2>;
    };

    /* --- 以下スクロール設定 (変更なし) --- */
    scroller {
        layers = <4>;
        input-processors = <&zip_xy_to_scroll_mapper>;
    };
    scroller_warp {
        layers = <5>;
        input-processors = <&zip_xy_scaler 4 1>, <&zip_xy_to_scroll_mapper>;
    };
    scroller_snipe {
        layers = <6>;
        input-processors = <&zip_xy_scaler 1 4>, <&zip_xy_to_scroll_mapper>;
    };
};

/ {
    keymap {
        compatible = "zmk,keymap";

        default_layer {
            bindings = <
                &kp A &kp A &kp A &kp A &kp A &kp A &kp A &kp A     &kp A &kp A &kp A &kp A &kp A &kp A &kp A &kp A &kp A
                &kp A &kp A &kp A &kp A &kp A &kp A &kp A &kp A     &kp A &kp A &kp A &kp A &kp A &kp A &kp A &kp A &kp A
                &kp A &kp A         &kp A &kp A &kp A &kp A &kp A     &kp A &kp A &kp A &kp A &kp A &kp A &kp A &kp A &kp A
                &kp A &kp A         &kp A &kp A &kp A &kp A &kp A     &kp A &kp A &kp A &kp A &kp A &kp A &kp A          &kp A
                &kp A &kp A         &kp A &kp A &kp A &kp A &kp A     &kp A &kp A &kp A &kp A &kp A &kp A &kp A &kp A
                &kp A     &kp A &kp A &kp A &kp A     &kp A &kp A     &kp A &kp A                                     &kp A &kp A &kp A
            >;

            sensor-bindings = <
                &inc_dec_kp LEFT_ARROW RIGHT_ARROW
                &inc_dec_kp UP_ARROW   DOWN_ARROW
                &inc_dec_kp LEFT_ARROW RIGHT_ARROW
                &inc_dec_kp UP_ARROW   DOWN_ARROW
            >;
        };
    };
};

